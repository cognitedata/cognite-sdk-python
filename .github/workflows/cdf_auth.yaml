name: cdf_auth

on:
  push:
    branches: [master]

jobs:
  cdf_auth:
    runs-on: ubuntu-latest
    environment: CD
    name: Update CDF Auth
    strategy:
      fail-fast: false
      matrix:
        config_env: [
          # TODO: Add this back once we get a new contributor project (one that's not in a staging cluster)
          #"contributor",
          "prod"
        ]
    container:
      image: cognite/toolkit:0.4.9
      env:
        CDF_CLUSTER: ${{ vars.CDF_CLUSTER_CD }}
        CDF_PROJECT: ${{ vars.CDF_PROJECT_CD }}
        IDP_CLIENT_ID: ${{ vars.IDP_CLIENT_ID_CD }}
        IDP_CLIENT_SECRET: ${{ secrets.IDP_CLIENT_SECRET_CD }}
        IDP_TENANT_ID: ${{ vars.IDP_TENANT_ID_CD }}
    steps:
      - uses: actions/checkout@v4
      - name: Build the CDF Groups
        working-directory: scripts/toolkit
        run: cdf build --env ${{ matrix.config_env }}
      - name: Update CDF Auth
        working-directory: scripts/toolkit
        run: cdf deploy
